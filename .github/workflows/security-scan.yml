name: å®šæ—¶å®‰å…¨æ‰«æ

on:
  # æ¯æ—¥å‡Œæ™¨2ç‚¹è¿è¡Œå®‰å…¨æ‰«æ
  schedule:
    - cron: '0 2 * * *'  # UTCæ—¶é—´å‡Œæ™¨2ç‚¹ï¼Œå¯¹åº”åŒ—äº¬æ—¶é—´ä¸Šåˆ10ç‚¹
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  security-scan:
    name: CodeQLå®‰å…¨æ‰«æ
    runs-on: ubuntu-22.04
    container:
      image: ghcr.io/quarklink/images/cpp-bazel-ci:1.0.5
    permissions:
      security-events: write
      contents: read
      actions: read
    steps:
    - name: Checkoutä»£ç 
      uses: actions/checkout@v4

    - name: åˆå§‹åŒ–CodeQLå®‰å…¨æ‰«æ
      uses: github/codeql-action/init@v3
      with:
        languages: cpp
        queries: security-and-quality

    - name: æ„å»ºé¡¹ç›®ç”¨äºå®‰å…¨åˆ†æ
      run: |
        echo "ğŸ”¨ æ„å»ºé¡¹ç›®ç”¨äºå®‰å…¨åˆ†æ..."
        bazel build //...
        echo "âœ… æ„å»ºå®Œæˆ"

    - name: æ‰§è¡ŒCodeQLå®‰å…¨åˆ†æ
      uses: github/codeql-action/analyze@v3
      with:
        category: "/language:cpp"

    - name: å®‰å…¨æ‰«æå®Œæˆé€šçŸ¥
      run: |
        echo "ğŸ” å®‰å…¨æ‰«æå·²å®Œæˆ"
        echo "ğŸ“Š è¯·æŸ¥çœ‹ GitHub Security æ ‡ç­¾é¡µè·å–è¯¦ç»†æŠ¥å‘Š"
        echo "ğŸ”— https://github.com/${{ github.repository }}/security/code-scanning" 
